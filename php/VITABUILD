pkgname=php
pkgver=8.1.7
pkgrel=1
gitrev=800d4cf45f11f5fedc5cbe4e56b326411e5a8981
url='https://www.php.net/'
source=(
  "https://github.com/isage/php-src/archive/${gitrev}.tar.gz"
 )
sha256sums=(
  SKIP
)
depends=(
    'sdl2'
    'sdl2_mixer'
    'sdl2_image'
)

prepare () {
  cd "${pkgname}-src-${gitrev}"
  ./buildconf --force
}

build() {
  cd "${pkgname}-src-${gitrev}"
  PATH="$VITASDK/arm-vita-eabi/bin:$PATH" \
  LIBS="-lSDL2 -ljpeg -lpng -lwebp -lwebpdemux -lxmp-lite -lmikmod -lmpg123 -lmodplug -lFLAC -lopusfile -lopus -lvorbisfile -lvorbis -logg -pthread -lz -lstdc++ -lc -lm" \
  ./configure --host=arm-vita-eabi --prefix=$prefix --without-pdo-sqlite --without-sqlite3 --disable-all --disable-cli --disable-cgi --without-pcre-jit --disable-phpdbg --enable-embed=static --with-sdl=${VITASDK}/arm-vita-eabi/bin/sdl2-config --without-pic --enable-sdl_mixer=${VITASDK}/arm-vita-eabi/ --enable-sdl_image=${VITASDK}/arm-vita-eabi/
  make -j$(nproc)
}

package () {
  cd "${pkgname}-src-${gitrev}"
  make INSTALL_ROOT=$pkgdir install
}
